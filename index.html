<html>

<head>
  <base href="https://fps-nexus.com/play/cs16tribute">
  <title>CS16 Tribute - Multiplayer FPS</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.3.2/socket.io.js"></script>
  <style>
    body,
    html {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: 'Arial', sans-serif;
      background-color: #000;
      color: #fff;
      overflow: hidden;
    }

    #game-container {
      width: 100%;
      height: 100%;
      position: relative;
    }

    #hud {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      padding: 20px;
      display: flex;
      justify-content: space-between;
      pointer-events: none;
    }

    #health,
    #ammo,
    #money {
      background: rgba(0, 0, 0, 0.5);
      padding: 10px;
      border-radius: 5px;
    }

    #crosshair {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 10px;
      height: 10px;
      border: 2px solid #fff;
      border-radius: 50%;
      pointer-events: none;
    }

    #menu {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.8);
      padding: 20px;
      border-radius: 10px;
      text-align: center;
    }

    #menu button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 10px 20px;
      margin: 10px;
      font-size: 18px;
      cursor: pointer;
      transition: background 0.3s;
    }

    #menu button:hover {
      background: #45a049;
    }

    #nickname-input {
      padding: 10px;
      font-size: 16px;
      margin-bottom: 10px;
    }

    #chat {
      position: absolute;
      bottom: 20px;
      left: 20px;
      width: 300px;
      background: rgba(0, 0, 0, 0.5);
      border-radius: 5px;
      padding: 10px;
      display: none;
    }

    #chat-messages {
      height: 150px;
      overflow-y: auto;
      margin-bottom: 10px;
    }

    #chat-input {
      width: 100%;
      padding: 5px;
      box-sizing: border-box;
    }

    .nickname {
      color: #ffffff;
      font-size: 14px;
      font-weight: bold;
      text-shadow: 0 0 3px #000000;
      pointer-events: none;
    }

    #buy-menu {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.8);
      padding: 20px;
      border-radius: 10px;
      display: none;
    }

    #buy-menu button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 5px 10px;
      margin: 5px;
      font-size: 14px;
      cursor: pointer;
      transition: background 0.3s;
    }

    #buy-menu button:hover {
      background: #45a049;
    }

    #round-info {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.5);
      padding: 10px;
      border-radius: 5px;
      text-align: center;
    }
  </style>
</head>

<body>
  <div id="game-container">
    <div id="hud">
      <div id="health">Health: 100</div>
      <div id="ammo">Ammo: 30 / 90</div>
      <div id="money">$: 800</div>
    </div>
    <div id="crosshair"></div>
    <div id="round-info">Round 1 - Terrorists: 0 | Counter-Terrorists: 0</div>
  </div>
  <div id="menu">
    <h1>CS16 Tribute</h1>
    <input type="text" id="nickname-input" placeholder="Enter your nickname">
    <button id="terrorist-btn">Join Terrorists</button>
    <button id="ct-btn">Join Counter-Terrorists</button>
  </div>
  <div id="chat">
    <div id="chat-messages"></div>
    <input type="text" id="chat-input" placeholder="Press Enter to chat">
  </div>
  <div id="buy-menu">
    <h2>Buy Menu</h2>
    <button onclick="buyWeapon('ak47')">AK-47 ($2500)</button>
    <button onclick="buyWeapon('m4a1')">M4A1 ($3100)</button>
    <button onclick="buyWeapon('awp')">AWP ($4750)</button>
    <button onclick="buyWeapon('deagle')">Desert Eagle ($650)</button>
    <button onclick="buyArmor()">Kevlar + Helmet ($1000)</button>
  </div>

  <script>
    let scene, camera, renderer, player, healthDisplay, ammoDisplay, moneyDisplay;
    let players = {};
    let bullets = [];
    let gameActive = false;
    let socket;
    let chatOpen = false;
    let team = '';
    let money = 800;
    let currentWeapon = 'pistol';
    let weapons = {
      pistol: { damage: 20, ammo: 12, maxAmmo: 24, fireRate: 400 },
      ak47: { damage: 35, ammo: 30, maxAmmo: 90, fireRate: 600 },
      m4a1: { damage: 33, ammo: 30, maxAmmo: 90, fireRate: 666 },
      awp: { damage: 115, ammo: 10, maxAmmo: 30, fireRate: 1500 },
      deagle: { damage: 50, ammo: 7, maxAmmo: 35, fireRate: 267 }
    };
    let buyTime = true;
    let roundNumber = 1;
    let terroristScore = 0;
    let ctScore = 0;

    // Variables for improved camera control
    let pitchObject, yawObject;

    // Variables for movement
    let moveForward = false;
    let moveBackward = false;
    let moveLeft = false;
    let moveRight = false;
    let canJump = false;
    let velocity = new THREE.Vector3();

    function init() {
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.shadowMap.enabled = true;
      renderer.shadowMap.type = THREE.PCFSoftShadowMap;
      document.getElementById('game-container').appendChild(renderer.domElement);

      // Create player (camera) with improved controls
      pitchObject = new THREE.Object3D();
      pitchObject.add(camera);

      yawObject = new THREE.Object3D();
      yawObject.position.y = 10;
      yawObject.add(pitchObject);

      scene.add(yawObject);

      // Create map
      createMap();

      // Lighting
      const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
      scene.add(ambientLight);

      const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
      directionalLight.position.set(100, 100, 100);
      directionalLight.castShadow = true;
      directionalLight.shadow.mapSize.width = 2048;
      directionalLight.shadow.mapSize.height = 2048;
      directionalLight.shadow.camera.near = 0.5;
      directionalLight.shadow.camera.far = 500;
      scene.add(directionalLight);

      healthDisplay = document.getElementById('health');
      ammoDisplay = document.getElementById('ammo');
      moneyDisplay = document.getElementById('money');

      document.addEventListener('mousemove', onMouseMove);
      document.addEventListener('click', shoot);
      document.addEventListener('keydown', onKeyDown);
      document.addEventListener('keyup', onKeyUp);

      // Lock pointer
      renderer.domElement.requestPointerLock = renderer.domElement.requestPointerLock ||
        renderer.domElement.mozRequestPointerLock;
      renderer.domElement.onclick = function () {
        renderer.domElement.requestPointerLock();
      };

      // Team selection buttons
      document.getElementById('terrorist-btn').addEventListener('click', () => joinGame('terrorist'));
      document.getElementById('ct-btn').addEventListener('click', () => joinGame('ct'));

      // Chat
      document.addEventListener('keydown', (event) => {
        if (event.key === 'Enter' && !chatOpen) {
          openChat();
        } else if (event.key === 'Escape' && chatOpen) {
          closeChat();
        }
      });

      document.getElementById('chat-input').addEventListener('keydown', (event) => {
        if (event.key === 'Enter') {
          sendChatMessage();
        }
      });

      // Initialize multiplayer
      initializeMultiplayer();

      animate();
    }

    function initializeMultiplayer() {
      socket = io('https://your-server-address.com');

      socket.on('connect', () => {
        console.log('Connected to server');
      });

      socket.on('players', (serverPlayers) => {
        Object.keys(serverPlayers).forEach((id) => {
          if (id !== socket.id && !players[id]) {
            createPlayer(id, serverPlayers[id]);
          }
        });
      });

      socket.on('playerJoined', (player) => {
        createPlayer(player.id, player);
        addChatMessage(`${player.nickname} joined the game`);
      });

      socket.on('playerMoved', (player) => {
        if (players[player.id]) {
          updatePlayerPosition(player.id, player.position, player.rotation);
        }
      });

      socket.on('playerLeft', (id) => {
        removePlayer(id);
      });

      socket.on('playerShot', (data) => {
        if (data.shooter !== socket.id) {
          createBullet(new THREE.Vector3().copy(data.position), new THREE.Vector3().copy(data.direction));
        }
      });

      socket.on('playerHit', (data) => {
        if (data.target === socket.id) {
          takeDamage(data.damage);
        }
      });

      socket.on('chatMessage', (data) => {
        addChatMessage(`${data.nickname}: ${data.message}`);
      });

      socket.on('roundStart', (data) => {
        startRound(data.roundNumber);
      });

      socket.on('roundEnd', (data) => {
        endRound(data.winner);
      });

      socket.on('updateScore', (data) => {
        updateScore(data.terroristScore, data.ctScore);
      });
    }

    function joinGame(selectedTeam) {
      const nickname = document.getElementById('nickname-input').value || 'Player';
      document.getElementById('menu').style.display = 'none';
      gameActive = true;
      team = selectedTeam;

      socket.emit('join', {
        nickname: nickname,
        team: team,
        position: yawObject.position,
        rotation: yawObject.rotation.y
      });

      // Set initial spawn position based on team
      if (team === 'terrorist') {
        yawObject.position.set(-20, 2, -20);
      } else {
        yawObject.position.set(20, 2, 20);
      }
    }

    function createPlayer(id, playerData) {
      const playerGroup = new THREE.Group();

      // Body
      const bodyGeometry = new THREE.BoxGeometry(0.6, 1.6, 0.6);
      const bodyMaterial = new THREE.MeshPhongMaterial({ color: playerData.team === 'terrorist' ? 0xff0000 : 0x0000ff });
      const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
      body.position.y = 0.8;
      playerGroup.add(body);

      // Head
      const headGeometry = new THREE.SphereGeometry(0.3, 32, 32);
      const headMaterial = new THREE.MeshPhongMaterial({ color: 0xffdab9 });
      const head = new THREE.Mesh(headGeometry, headMaterial);
      head.position.y = 1.7;
      playerGroup.add(head);

      // Arms
      const armGeometry = new THREE.BoxGeometry(0.2, 0.6, 0.2);
      const armMaterial = new THREE.MeshPhongMaterial({ color: playerData.team === 'terrorist' ? 0xcc0000 : 0x0000cc });
      const leftArm = new THREE.Mesh(armGeometry, armMaterial);
      leftArm.position.set(-0.4, 0.8, 0);
      playerGroup.add(leftArm);

      const rightArm = leftArm.clone();
      rightArm.position.set(0.4, 0.8, 0);
      playerGroup.add(rightArm);

      // Legs
      const legGeometry = new THREE.BoxGeometry(0.2, 0.8, 0.2);
      const legMaterial = new THREE.MeshPhongMaterial({ color: 0x000000 });
      const leftLeg = new THREE.Mesh(legGeometry, legMaterial);
      leftLeg.position.set(-0.2, -0.4, 0);
      playerGroup.add(leftLeg);

      const rightLeg = leftLeg.clone();
      rightLeg.position.set(0.2, -0.4, 0);
      playerGroup.add(rightLeg);

      playerGroup.position.copy(playerData.position);
      playerGroup.rotation.y = playerData.rotation;
      scene.add(playerGroup);

      // Add nickname
      const nicknameDiv = document.createElement('div');
      nicknameDiv.className = 'nickname';
      nicknameDiv.textContent = playerData.nickname;
      const nicknameObject = new THREE.CSS2DObject(nicknameDiv);
      nicknameObject.position.set(0, 2.2, 0);
      playerGroup.add(nicknameObject);

      players[id] = {
        group: playerGroup,
        nickname: playerData.nickname,
        team: playerData.team
      };
    }

    function updatePlayerPosition(id, position, rotation) {
      if (players[id] && players[id].group) {
        players[id].group.position.copy(position);
        players[id].group.rotation.y = rotation;

        // Animate legs and arms
        const leftLeg = players[id].group.children[4];
        const rightLeg = players[id].group.children[5];
        const leftArm = players[id].group.children[2];
        const rightArm = players[id].group.children[3];

        const walkCycle = Date.now() * 0.005;
        leftLeg.rotation.x = Math.sin(walkCycle) * 0.5;
        rightLeg.rotation.x = Math.sin(walkCycle + Math.PI) * 0.5;
        leftArm.rotation.x = Math.sin(walkCycle + Math.PI) * 0.5;
        rightArm.rotation.x = Math.sin(walkCycle) * 0.5;
      }
    }

    function removePlayer(id) {
      if (players[id]) {
        scene.remove(players[id].group);
        delete players[id];
      }
    }

    function onMouseMove(event) {
      if (!gameActive || !document.pointerLockElement) return;

      const movementX = event.movementX || event.mozMovementX || event.webkitMovementX || 0;
      const movementY = event.movementY || event.mozMovementY || event.webkitMovementY || 0;

      yawObject.rotation.y -= movementX * 0.002;
      pitchObject.rotation.x -= movementY * 0.002;

      pitchObject.rotation.x = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, pitchObject.rotation.x));

      socket.emit('move', { position: yawObject.position, rotation: yawObject.rotation.y });
    }

    function shoot() {
      if (!gameActive || chatOpen || weapons[currentWeapon].ammo <= 0) return;

      weapons[currentWeapon].ammo--;
      updateAmmoDisplay();

      const bulletPosition = new THREE.Vector3();
      const bulletDirection = new THREE.Vector3();
      camera.getWorldPosition(bulletPosition);
      camera.getWorldDirection(bulletDirection);

      createBullet(bulletPosition, bulletDirection);

      socket.emit('shoot', {
        position: bulletPosition,
        direction: bulletDirection,
        weapon: currentWeapon
      });

      // Play gunshot sound
      playSound('gunshot');
    }

    function createBullet(position, direction) {
      const bulletGeometry = new THREE.SphereGeometry(0.05, 8, 8);
      const bulletMaterial = new THREE.MeshBasicMaterial({ color: 0xffff00 });
      const bullet = new THREE.Mesh(bulletGeometry, bulletMaterial);

      bullet.position.copy(position);
      bullet.velocity = direction.multiplyScalar(1);

      scene.add(bullet);
      bullets.push(bullet);

      return bullet;
    }

    function updateGame() {
      if (!gameActive) return;

      const time = performance.now();
      const delta = (time - prevTime) / 1000;

      velocity.x -= velocity.x * 10.0 * delta;
      velocity.z -= velocity.z * 10.0 * delta;

      velocity.y -= 9.8 * 100.0 * delta; // 100.0 = mass

      const speed = 100.0;

      if (moveForward) velocity.z -= speed * delta;
      if (moveBackward) velocity.z += speed * delta;
      if (moveLeft) velocity.x -= speed * delta;
      if (moveRight) velocity.x += speed * delta;

      yawObject.translateX(velocity.x * delta);
      yawObject.translateY(velocity.y * delta);
      yawObject.translateZ(velocity.z * delta);

      if (yawObject.position.y < 2) {
        velocity.y = 0;
        yawObject.position.y = 2;
        canJump = true;
      }

      // Update bullets
      for (let i = bullets.length - 1; i >= 0; i--) {
        const bullet = bullets[i];
        bullet.position.add(bullet.velocity);

        // Check for collisions with players
        Object.keys(players).forEach((id) => {
          if (id !== socket.id) {
            const playerPosition = players[id].group.position;
            if (bullet.position.distanceTo(playerPosition) < 1) {
              scene.remove(bullet);
              bullets.splice(i, 1);
              socket.emit('hit', {
                target: id,
                damage: weapons[currentWeapon].damage
              });
            }
          }
        });

        // Remove bullets that have traveled too far
        if (bullet.position.distanceTo(yawObject.position) > 100) {
          scene.remove(bullet);
          bullets.splice(i, 1);
        }
      }

      // Emit player movement to server
      socket.emit('move', { position: yawObject.position, rotation: yawObject.rotation.y });

      prevTime = time;
    }

    function animate() {
      requestAnimationFrame(animate);
      if (gameActive) {
        updateGame();
      }
      renderer.render(scene, camera);
    }

    function createMap() {
      // Floor
      const floorGeometry = new THREE.PlaneGeometry(100, 100);
      const floorMaterial = new THREE.MeshPhongMaterial({ color: 0x808080 });
      const floor = new THREE.Mesh(floorGeometry, floorMaterial);
      floor.rotation.x = -Math.PI / 2;
      floor.receiveShadow = true;
      scene.add(floor);

      // Walls
      const wallGeometry = new THREE.BoxGeometry(100, 10, 1);
      const wallMaterial = new THREE.MeshPhongMaterial({ color: 0xa0a0a0 });

      const wall1 = new THREE.Mesh(wallGeometry, wallMaterial);
      wall1.position.set(0, 5, 50);
      wall1.castShadow = true;
      wall1.receiveShadow = true;
      scene.add(wall1);

      const wall2 = new THREE.Mesh(wallGeometry, wallMaterial);
      wall2.position.set(0, 5, -50);
      wall2.castShadow = true;
      wall2.receiveShadow = true;
      scene.add(wall2);

      const wall3 = new THREE.Mesh(wallGeometry, wallMaterial);
      wall3.position.set(50, 5, 0);
      wall3.rotation.y = Math.PI / 2;
      wall3.castShadow = true;
      wall3.receiveShadow = true;
      scene.add(wall3);

      const wall4 = new THREE.Mesh(wallGeometry, wallMaterial);
      wall4.position.set(-50, 5, 0);
      wall4.rotation.y = Math.PI / 2;
      wall4.castShadow = true;
      wall4.receiveShadow = true;
      scene.add(wall4);

      // Add some crates for cover
      const crateGeometry = new THREE.BoxGeometry(2, 2, 2);
      const crateMaterial = new THREE.MeshPhongMaterial({ color: 0x8B4513 });

      for (let i = 0; i < 10; i++) {
        const crate = new THREE.Mesh(crateGeometry, crateMaterial);
        crate.position.set(
          Math.random() * 80 - 40,
          1,
          Math.random() * 80 - 40
        );
        crate.castShadow = true;
        crate.receiveShadow = true;
        scene.add(crate);
      }
    }

    function openChat() {
      chatOpen = true;
      document.getElementById('chat').style.display = 'block';
      document.getElementById('chat-input').focus();
    }

    function closeChat() {
      chatOpen = false;
      document.getElementById('chat').style.display = 'none';
      document.getElementById('chat-input').value = '';
    }

    function sendChatMessage() {
      const message = document.getElementById('chat-input').value.trim();
      if (message && socket) {
        socket.emit('chatMessage', message);
        addChatMessage(`You: ${message}`);
        document.getElementById('chat-input').value = '';
      }
      closeChat();
    }

    function addChatMessage(message) {
      const chatMessages = document.getElementById('chat-messages');
      const messageElement = document.createElement('div');
      messageElement.textContent = message;
      chatMessages.appendChild(messageElement);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function onKeyDown(event) {
      if (chatOpen) return;

      switch (event.keyCode) {
        case 87: // w
          moveForward = true;
          break;
        case 65: // a
          moveLeft = true;
          break;
        case 83: // s
          moveBackward = true;
          break;
        case 68: // d
          moveRight = true;
          break;
        case 32: // space
          if (canJump === true) velocity.y += 350;
          canJump = false;
          break;
        case 66: // b
          if (buyTime) toggleBuyMenu();
          break;
        case 82: // r
          reload();
          break;
      }
    }

    function onKeyUp(event) {
      switch (event.keyCode) {
        case 87: // w
          moveForward = false;
          break;
        case 65: // a
          moveLeft = false;
          break;
        case 83: // s
          moveBackward = false;
          break;
        case 68: // d
          moveRight = false;
          break;
      }
    }

    function toggleBuyMenu() {
      const buyMenu = document.getElementById('buy-menu');
      if (buyMenu.style.display === 'none') {
        buyMenu.style.display = 'block';
      } else {
        buyMenu.style.display = 'none';
      }
    }

    function buyWeapon(weapon) {
      const prices = {
        ak47: 2500,
        m4a1: 3100,
        awp: 4750,
        deagle: 650
      };

      if (money >= prices[weapon]) {
        money -= prices[weapon];
        currentWeapon = weapon;
        weapons[currentWeapon].ammo = weapons[currentWeapon].maxAmmo;
        updateMoneyDisplay();
        updateAmmoDisplay();
        toggleBuyMenu();
        playSound('purchase');
      } else {
        playSound('error');
      }
    }

    function buyArmor() {
      if (money >= 1000) {
        money -= 1000;
        // Implement armor logic here
        updateMoneyDisplay();
        toggleBuyMenu();
        playSound('purchase');
      } else {
        playSound('error');
      }
    }

    function reload() {
      if (weapons[currentWeapon].ammo < weapons[currentWeapon].maxAmmo) {
        weapons[currentWeapon].ammo = weapons[currentWeapon].maxAmmo;
        updateAmmoDisplay();
        playSound('reload');
      }
    }

    function updateHealthDisplay() {
      healthDisplay.textContent = `Health: ${health}`;
    }

    function updateAmmoDisplay() {
      ammoDisplay.textContent = `Ammo: ${weapons[currentWeapon].ammo} / ${weapons[currentWeapon].maxAmmo}`;
    }

    function updateMoneyDisplay() {
      moneyDisplay.textContent = `$: ${money}`;
    }

    function takeDamage(damage) {
      health -= damage;
      updateHealthDisplay();
      playSound('hit');
      if (health <= 0) {
        die();
      }
    }

    function die() {
      health = 100;
      updateHealthDisplay();
      // Implement respawn logic here
      playSound('death');
    }

    function startRound(round) {
      roundNumber = round;
      buyTime = true;
      setTimeout(() => {
        buyTime = false;
        document.getElementById('buy-menu').style.display = 'none';
      }, 15000); // 15 seconds buy time
      updateRoundInfo();
    }

    function endRound(winner) {
      buyTime = false;
      document.getElementById('buy-menu').style.display = 'none';
      // Implement round end logic here (e.g., display winner, update scores)
      playSound(winner === team ? 'roundWin' : 'roundLose');
    }

    function updateScore(tScore, ctScore) {
      terroristScore = tScore;
      ctScore = ctScore;
      updateRoundInfo();
    }

    function updateRoundInfo() {
      document.getElementById('round-info').textContent = `Round ${roundNumber} - Terrorists: ${terroristScore} | Counter-Terrorists: ${ctScore}`;
    }

    function playSound(soundName) {
      // Implement sound playing logic here
      console.log(`Playing sound: ${soundName}`);
    }

    let prevTime = performance.now();
    let health = 100;

    init();
  </script>

</body>

</html>
